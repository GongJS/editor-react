var F=Object.defineProperty,I=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var m=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var v=(e,t,r)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,l=(e,t)=>{for(var r in t||(t={}))_.call(t,r)&&v(e,r,t[r]);if(m)for(var r of m(t))E.call(t,r)&&v(e,r,t[r]);return e},x=(e,t)=>I(e,j(t));var L=(e,t)=>{var r={};for(var o in e)_.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&m)for(var o of m(e))t.indexOf(o)<0&&E.call(e,o)&&(r[o]=e[o]);return r};import{j as s,S as D,a as R,B as U,T as A,R as N,r as P,l as $,m as p,b as g,c as B,u as q,d as b,e as f,Q as z,f as H,g as V,h as y,i as G,N as M,k as Q,E as W,n as J,o as K}from"./vendor.f7173d25.js";const X=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerpolicy&&(a.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?a.credentials="include":n.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}};X();const Y=()=>s("div",{className:"full-page-loading",children:s(D,{size:"large"})});const Z=e=>e==null?void 0:e.message,ee=({error:e})=>Z(e)?s(A.Text,{type:"danger",children:e==null?void 0:e.message}):null,te=({error:e,resetErrorBoundary:t})=>R("div",{className:"full-page-error-fallback",children:[s(ee,{error:e}),s(U,{style:{marginTop:"50px"},type:"primary",onClick:t,children:"Reset"})]}),re="modulepreload",S={},oe="/",k=function(t,r){return!r||r.length===0?t():Promise.all(r.map(o=>{if(o=`${oe}${o}`,o in S)return;S[o]=!0;const n=o.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${a}`))return;const i=document.createElement("link");if(i.rel=n?"stylesheet":re,n||(i.as="script",i.crossOrigin=""),i.href=o,document.head.appendChild(i),n)return new Promise((u,d)=>{i.addEventListener("load",u),i.addEventListener("error",d)})})).then(()=>t())},h=N({key:"userData",default:{isLogin:!1,token:localStorage.getItem("token"),data:{}}}),pe="https://koa-img.herokuapp.com/p",ne="https://api-proxy-six.vercel.app/api",w=async(e,a={})=>{var i=a,{data:t,token:r,headers:o}=i,n=L(i,["data","token","headers"]);const u=l({method:"GET",headers:{Authorization:r?`Bearer ${r}`:"","Content-Type":t?"application/json":""}},n);return u.method.toUpperCase()==="GET"?t&&(e+=`?${$.stringify(t)}`):u.body=JSON.stringify(t||{}),window.fetch(`${ne}/${e}`,u).then(async d=>{if(d.ok){const c=await d.json();return c.errno===0?c.data:c.errno===12001?(localStorage.removeItem("token"),p.error(c.message),window.location.reload(),Promise.reject(c)):(p.error(c.message),Promise.reject(c))}return p.error(d.statusText),Promise.reject(t)})},C=()=>{const e=g(h);return P.exports.useCallback((...[t,r])=>w(t,x(l({},r),{token:(e==null?void 0:e.token)||(r==null?void 0:r.token)})),[e==null?void 0:e.token])},O=()=>{const e=B(h),t=q();return{logout:n=>{e({isLogin:!1,token:"",data:{}}),localStorage.removeItem("token"),p.success(n||"\u9000\u51FA\u767B\u5F55\u6210\u529F\uFF0C2\u79D2\u540E\u8DF3\u8F6C\u5230\u9996\u9875",2),setTimeout(()=>{t("/")},2e3)},setUserData:n=>{e(a=>l(l({},a),n)),localStorage.setItem("token",n.token)}}},T=async e=>await w("users/getUserInfo",{token:e}),he=()=>{const e=C(),{setUserData:t}=O();return b(r=>e("users/loginByPhoneNumber",{data:r,method:"POST"}),{onSuccess:async r=>{const o=await T(r.token);t({token:r.token,isLogin:!0,data:l({},o)})}})},ge=()=>{const e=C();return b(t=>e("users/genVeriCode",{data:t,method:"POST"}))};const se=f.lazy(()=>k(()=>import("./index.e48a0ad3.js"),["assets/index.e48a0ad3.js","assets/index.74651486.css","assets/vendor.f7173d25.js","assets/logo-simple.54deed43.js"])),ae=f.lazy(()=>k(()=>import("./index.a7e61814.js"),["assets/index.a7e61814.js","assets/index.970fac3c.css","assets/vendor.f7173d25.js","assets/logo-simple.54deed43.js","assets/index.5fd53806.js"])),ie=f.lazy(()=>k(()=>import("./index.b5ad1c11.js"),["assets/index.b5ad1c11.js","assets/index.e759d972.css","assets/vendor.f7173d25.js","assets/index.5fd53806.js"])),ce=new z({defaultOptions:{queries:{refetchOnWindowFocus:!1}}}),le=({children:e})=>{const t=g(h),r=G();return t.token?e:s(M,{to:"/login",state:{from:r}})};function ue(){const{setUserData:e}=O(),t=g(h),r=o=>s(le,{children:s(o,{})});return P.exports.useEffect(()=>{t.token&&T(t.token).then(o=>{e({token:t.token,isLogin:!0,data:l({},o)})})},[]),s("div",{className:"App",children:s(H,{client:ce,children:R(V,{children:[s(y,{path:"/",element:r(se)}),s(y,{path:"/login",element:s(ie,{})}),s(y,{path:"/editor/:workId",element:r(ae)})]})})})}const de=(e,t)=>{console.log("error:",e,"info:",t)};Q.render(s(f.StrictMode,{children:s(W,{FallbackComponent:te,onError:de,children:s(f.Suspense,{fallback:s(Y,{}),children:s(J,{children:s(K,{children:s(ue,{})})})})})}),document.getElementById("root"));export{O as a,C as b,pe as c,he as d,ge as e,h as u};
